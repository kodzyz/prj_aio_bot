from aiogram import types
from aiogram.types import ReplyKeyboardMarkup
from aiogram.types import ReplyKeyboardRemove
# –æ–±—ä–µ–∫—Ç, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π —Å—Ç–∞—Ä—Ç –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
from aiogram import executor
from logging import basicConfig, INFO

from data.config import ADMINS
from loader import dp, db, bot

# –õ–∏—Å—Ç–∏–Ω–≥ 3.5. step_2 /app.py
import handlers

# —Ä–∞–±–æ—Ç–∞ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
# –∑–∞–ø—É—Å–∫–∞–µ–º—ã–π –º–æ–¥—É–ª—å –ø—Ä–æ–µ–∫—Ç–∞

user_message = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
admin_message = '–ê–¥–º–∏–Ω'


# –õ–∏—Å—Ç–∏–Ω–≥ 2.4. step_2 /app.py
# –°–æ–∑–¥–∞–µ–º –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã ¬´start¬ª –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
@dp.message_handler(commands=['start'])
async def cmd_start(message: types.Message):
    '''
    –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä dp.message_handler - –ø–æ–¥–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫
    —Å–∏—Å—Ç–µ–º–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞(dp)

    commands=['start'] - —É–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ
    –∫–æ–º–∞–Ω–¥–∞ /start –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º cmd_start

    :param message: –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞ - —Å–æ–æ–±—â–µ–Ω–∏–µ,
    –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥–∞–µ—Ç –±–æ—Ç—É
    :return:
    '''

    # –æ–±—ä–µ–∫—Ç-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ - –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    # resize_keyboard - –∞–≤—Ç–æ –ø–æ–¥–≥–æ–Ω–∫–∞ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ Telegram
    markup = ReplyKeyboardMarkup(resize_keyboard=True)

    # –¥–≤–µ –∫–Ω–æ–ø–∫–∏ ‚Äì –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–æ–≤
    # —Ç–µ–∫—Å—Ç, —É–∫–∞–∑–∞–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
    markup.row(user_message, admin_message)
    # –∫ –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

    # –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä await –≤ async def -> cmd_start –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
    # –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è message.answer, –≤—ã–∑–æ–≤ –∫–æ—Ç–æ—Ä–æ–π –∏–¥–µ—Ç –ø–æ—Å–ª–µ await
    # –ø—Ä–∏ —ç—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏

    await message.answer('''–ü—Ä–∏–≤–µ—Ç! üëã
    
ü§ñ –Ø –±–æ—Ç-–º–∞–≥–∞–∑–∏–Ω –ø–æ –ø–æ–¥–∞–∂–µ —Ç–æ–≤–∞—Ä–æ–≤ –ª—é–±–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
    
üõçÔ∏è –ß—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ –∏ –≤—ã–±—Ä–∞—Ç—å –ø—Ä–∏–≥–ª—è–Ω—É–≤—à–∏–µ—Å—è 
—Ç–æ–≤–∞—Ä—ã –≤–æ–∑–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–æ–º–∞–Ω–¥–æ–π /menu.

‚ùì –í–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã? –ù–µ –ø—Ä–æ–±–ª–µ–º–∞! –ö–æ–º–∞–Ω–¥–∞ /sos –ø–æ–º–æ–∂–µ—Ç 
—Å–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å—Ç–∞—Ä–∞—é—Ç—Å—è –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è.
''', reply_markup=markup)


# reply_markup=markup - —Ä–∞–∑–º–µ—â–∞–µ–º –¥–≤–µ –∫–Ω–æ–ø–∫–∏

# –õ–∏—Å—Ç–∏–Ω–≥ 2.5. step_2 /app.py
# –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫ –∫–Ω–æ–ø–∫–µ admin_message - —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
@dp.message_handler(text=admin_message)
async def admin_mode(message: types.Message):
    # –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ admin_message –¥–µ–ª–∞–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ê–¥–º–∏–Ω–æ–º

    # –ø–æ–ª—É—á–∞–µ–º id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (id —á–∞—Ç–∞)
    cid = message.chat.id

    # –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∞
    if cid not in ADMINS:
        ADMINS.append(cid)

    # –ù–∞ –ø–æ—Å—Ç—É–ø–∏–≤—à–∏–π –∑–∞–ø—Ä–æ—Å(–Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏) –º—ã –¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–≤–µ—Ç
    await message.answer('–í–∫–ª—é—á–µ–Ω –∞–¥–º–∏–Ω—Å–∫–∏–π —Ä–µ–∂–∏–º.',
                         reply_markup=ReplyKeyboardRemove())
    # ReplyKeyboardRemove() - —É–¥–∞–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞


# –õ–∏—Å—Ç–∏–Ω–≥ 2.6. step_2 /app.py
# –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫ –∫–Ω–æ–ø–∫–µ user_message - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º
@dp.message_handler(text=user_message)
async def user_mode(message: types.Message):
    cid = message.chat.id
    if cid in ADMINS:
        # —É–¥–∞–ª—è–µ–º id –∏–∑ —Å–ø–∏—Å–∫–∞ - –∫–ª–∏–µ–Ω—Ç –Ω–µ –∞–¥–º–∏–Ω, –∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        ADMINS.remove(cid)
    await message.answer('–í–∫–ª—é—á–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º.',
                         reply_markup=ReplyKeyboardRemove())


# –õ–∏—Å—Ç–∏–Ω–≥ 2.11. step_2 /app.py
async def on_startup(dp):
    # –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    basicConfig(level=INFO)
    # —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã
    db.create_tables()


if __name__ == '__main__':
    # –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –æ–±—ä–µ–∫—Ç–∞-–¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ on_startup()
    executor.start_polling(dp, on_startup=on_startup, skip_updates=False)
# skip_updates=False - –µ—Å–ª–∏ –±–æ—Ç –≤—ã–∫–ª—é—á–µ–Ω,
# —Ä–∞–Ω–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –±—É–¥—É—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã
